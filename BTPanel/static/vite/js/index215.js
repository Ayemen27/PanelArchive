import{d as a,ae as e,af as l,u as t,ag as s,ah as n,ai as i,aB as d,_ as o}from"./public.js?v=1758532619827";import{_ as u}from"./index.vue_vue_type_script_setup_true_lang.js?v=1758532619827";import{a1 as r}from"./site.js?v=1758532619827";import{c as p,w as _,aT as m,R as c}from"./page_layout.js?v=1758532619827";import{d5 as h,dU as f,dT as v,dP as y,_ as S,dV as x,au as g,d9 as w,eg as b}from"./naive.js?v=1758532619827";import{k as L,P as k,r as A,e as $,c as z,w as Z,o as j,R as U,S as R,X as E,a3 as O,V as F,j as P,a4 as q,a2 as B,an as C,F as H,O as J,U as M}from"./vue.js?v=1758532619827";import"./common.js?v=1758532619827";import"./__commonjsHelpers__.js?v=1758532619827";const N={class:"p-16px"},T={key:0},V={key:1},W=L({__name:"index",props:{onRefresh:{type:Function},onOpenLog:{type:Function}},setup(L,{expose:W}){const{t:X}=k(),D=L,G=A(null),I=$({auth_type:"dns",dns_manual:0,site:0,type:"wildcard",domains:"",domains_list:[],all:!1}),K=A([{label:X("SSL.index_17"),value:"single"},{label:X("SSL.index_18"),value:"wildcard"},{label:X("SSL.index_19"),value:"wildcard_all"}]),Q=A([]),Y=A([]),aa=()=>{I.domains=""},ea=()=>{I.domains_list=[],da()},la=z((()=>I.domains_list.length>0&&I.domains_list.length<Y.value.length));Z((()=>I.domains_list),(a=>{a.length===Y.value.length?I.all=!0:a.length||(I.all=!1)})),Z((()=>I.all),(a=>{var e;a?(I.domains_list=Y.value.map((a=>a.name)),null==(e=G.value)||e.validate()):I.domains_list=[]}));const ta={domains:{required:!0,trigger:"input",validator:(a,e)=>{if("single"===I.type){if(!e)return new Error(X("SSL.index_20"));if(!/^[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+$/.test(e))return new Error(X("SSL.index_21"))}else if("wildcard"===I.type){if(!e)return new Error(X("SSL.index_22"));if(!/^(?:\*\.)?(?:[a-zA-Z0-9-]+\.)?[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+(\n(?:\*\.)?(?:[a-zA-Z0-9-]+\.)?[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+)*$/.test(e))return new Error(X("SSL.index_23"))}else if("wildcard_all"===I.type){if(!e)return new Error(X("SSL.index_24"));if(!/^\*\.[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+(\n\*\.[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+)*$/i.test(e))return new Error(X("SSL.index_25"))}return!0}},domains_list:{required:!0,trigger:"change",type:"array",message:X("SSL.SiteSSL.index_16")}},sa=()=>({auth_type:I.dns_manual?"dns_manual":I.auth_type,domains:JSON.stringify("http"===I.auth_type?I.domains_list:"single"===I.type?[I.domains]:I.domains.split("\n")),site_id:I.dns_manual?-1:void 0}),{loading:na,setLoading:ia}=a(),da=async()=>{try{ia(!0);const{message:a}=await r({id:I.site});_(a)&&(Y.value=a.map((a=>({name:a.name}))))}finally{ia(!1)}};return j((async()=>{await(async()=>{const{message:a}=await d();_(a)&&(Q.value=a.map((a=>({label:a.name,value:a.id}))),I.site=Q.value[0].value)})(),da()})),W({onConfirm:async()=>{var a;if(await(null==(a=G.value)?void 0:a.validate()),I.dns_manual&&"dns"===I.auth_type){const a=JSON.stringify("single"===I.type?[I.domains]:I.domains.split("\n")),{message:d}=await e({site_id:-1,domains:a});if(p(d)&&Object.keys(d).length)return l(d.auths,-1,[I.domains],(()=>{D.onRefresh()}),!0),!1;const u=t({width:500,height:300,hideClose:!0,component:s});try{const{message:a}=await n(sa(),!1);if(p(a)){if(a.deploy)return void D.onRefresh();Array.isArray(a.auths)&&a.auths.length&&l(a.auths,-1,[I.domains],(()=>{D.onRefresh()}))}}catch(o){i(h(o,"message",""))}finally{u.hide()}return}const{message:d}=await n(sa());p(d)&&D.onOpenLog(d.path),D.onRefresh()}}),(a,e)=>{const l=f,t=m,s=v,n=y,i=S,d=x,r=g,p=w,_=b,h=c,L=u,k=o;return U(),R("div",N,[E(L,{ref_key:"formRef",ref:G,model:F(I),rules:ta,"label-width":"150px"},{default:O((()=>[E(n,{label:a.$t("Waf.Setting.config_67"),path:"verify_method"},{default:O((()=>[E(s,{value:F(I).auth_type,"onUpdate:value":e[0]||(e[0]=a=>F(I).auth_type=a)},{default:O((()=>[E(t,null,{default:O((()=>[E(l,{value:"dns"},{default:O((()=>[P(q(a.$t("SSL.index_12")),1)])),_:1}),E(l,{value:"http"},{default:O((()=>[P(q(a.$t("SSL.SiteSSL.index_17")),1)])),_:1})])),_:1})])),_:1},8,["value"])])),_:1},8,["label"]),"dns"===F(I).auth_type?(U(),R("div",T,[E(n,{label:" "},{default:O((()=>[E(i,{checked:F(I).dns_manual,"onUpdate:checked":e[1]||(e[1]=a=>F(I).dns_manual=a),"checked-value":1,"unchecked-value":0},{default:O((()=>[P(q(a.$t("SSL.index_2")),1)])),_:1},8,["checked"])])),_:1}),E(n,{label:a.$t("SSL.index_13"),path:"type"},{default:O((()=>[E(d,{class:"w-300px",value:F(I).type,"onUpdate:value":[e[2]||(e[2]=a=>F(I).type=a),aa],options:F(K)},null,8,["value","options"])])),_:1},8,["label"]),"single"===F(I).type?(U(),B(n,{key:0,label:" ",path:"domains"},{default:O((()=>[E(r,{"input-props":{spellcheck:!1},class:"w-300px!",value:F(I).domains,"onUpdate:value":e[3]||(e[3]=a=>F(I).domains=a),placeholder:"aapanel.com"},null,8,["value"])])),_:1})):C("",!0),"wildcard"===F(I).type?(U(),B(n,{key:1,label:" ",path:"domains"},{default:O((()=>[E(r,{"input-props":{spellcheck:!1},type:"textarea",class:"w-300px!",value:F(I).domains,"onUpdate:value":e[4]||(e[4]=a=>F(I).domains=a),placeholder:a.$t("SSL.index_14")},null,8,["value","placeholder"])])),_:1})):C("",!0),"wildcard_all"===F(I).type?(U(),B(n,{key:2,label:" ",path:"domains"},{default:O((()=>[E(r,{"input-props":{spellcheck:!1},type:"textarea",class:"w-300px!",value:F(I).domains,"onUpdate:value":e[5]||(e[5]=a=>F(I).domains=a),placeholder:"*.aapanel.com"},null,8,["value"])])),_:1})):C("",!0)])):C("",!0),"http"===F(I).auth_type?(U(),R("div",V,[E(n,{label:a.$t("Home.index_68")},{default:O((()=>[E(d,{class:"w-300px",value:F(I).site,"onUpdate:value":[e[6]||(e[6]=a=>F(I).site=a),ea],options:F(Q)},null,8,["value","options"])])),_:1},8,["label"]),E(n,{label:a.$t("Mail.Bcc.index_6"),path:"domains_list"},{default:O((()=>[E(h,{show:F(na),class:"p-12px w-300px max-h-300px min-h-100px overflow-auto border border-solid border-#ccc"},{default:O((()=>[E(i,{class:"mb-12px",checked:F(I).all,"onUpdate:checked":e[7]||(e[7]=a=>F(I).all=a),label:a.$t("Public.SelectAll"),indeterminate:F(la)},null,8,["checked","label","indeterminate"]),E(_,{value:F(I).domains_list,"onUpdate:value":e[8]||(e[8]=a=>F(I).domains_list=a)},{default:O((()=>[E(p,{class:"flex-col!",size:12},{default:O((()=>[(U(!0),R(H,null,J(F(Y),(a=>(U(),B(i,{key:a.name,value:a.name,label:a.name},null,8,["value","label"])))),128))])),_:1})])),_:1},8,["value"])])),_:1},8,["show"])])),_:1},8,["label"])])):C("",!0)])),_:1},8,["model"]),E(k,{class:"mt-16px"},{default:O((()=>[M("li",null,q(a.$t("SSL.index_15")),1),e[9]||(e[9]=M("li",null,"Manually resolved certificates do not support auto-renewal",-1)),M("li",null,q(a.$t("SSL.index_16")),1)])),_:1,__:[9]})])}}});export{W as default};
