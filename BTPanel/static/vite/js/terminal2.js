import{x as e,a as o,b as t,c as a}from"./xterm.js?v=1758532619827";import{x as n}from"./xterm-addon-canvas.js?v=1758532619827";import{k as s,P as d,a0 as r,r as l,w as i,ap as c,o as u,b as p,R as m,S as v,n as f}from"./vue.js?v=1758532619827";import{d4 as w,p as x}from"./page_layout.js?v=1758532619827";import{D as A}from"./public.js?v=1758532619827";const h=x(s({__name:"terminal",props:{data:{}},emits:["updateState","connectSuccess"],setup(s,{expose:x,emit:h}){const{t:g}=d(),S=s,{data:b}=S,_=h,C=w(),{isFull:O}=r(C),{ws:j,status:k,send:y,open:T,close:D}=A("/webssh",{verifyData:{host:b.host,port:b.port,id:b.id,ps:b.ps,sort:0},onMessage:(e,o)=>{const t=o.data;return t.indexOf("Authentication timeout.")>-1&&(M.value=!0),-1==t.indexOf("@127.0.0.1:")&&-1==t.indexOf("@localhost:")||-1==t.indexOf("Authentication failed")?"\\r\\nlogout\\r\\n"==t||"logout\\r\\n"==t||"\r\nlogout\r\n"==t||"logout\r\n"==t||t.search(/logout[\r\n]+$/)>-1?(_("updateState",b.id,!1),z.write("\r"+g("Component.Terminal.index_1")+"\r"),H(),void D()):void _("connectSuccess",t):(_("updateState",b.id,!1),D(),void H())}});let z,F;const M=l(!1),R=l(null),L=()=>{const e=j.value;e&&(z.loadAddon(F),z.loadAddon(new n.CanvasAddon),z.loadAddon(new t.WebLinksAddon),z.loadAddon(new a.AttachAddon(e)),setTimeout((()=>{F.fit();const e=R.value;e&&(I.value="".concat(e.clientHeight,"px"))}),100))},B=()=>{R.value&&z.open(R.value)};let E=!1;const H=()=>{E=!1},I=l(""),N=()=>{z.focus(),z.onData((e=>{const o=j.value;"\r"===e&&M.value&&(M.value=!1,z.write("\r\n"),P()),void 0!==o||"\r"!==e||E||(E=!0,z.write("\r\n"+g("Component.Terminal.index_2")+"\r\n"),P())}))},P=()=>{T(),N();const e=j.value;e&&(z.loadAddon(new a.AttachAddon(e)),_("updateState",b.id,!0))},W=()=>{f((()=>{if(F.fit(),"CLOSED"!==k.value){_("updateState",b.id,!0);const{cols:e,rows:o}=z;y({cols:e,rows:o,resize:1})}}))};i((()=>O.value),(e=>{const o=R.value;o&&!e&&(o.style.height=I.value)}));let $=!0;const q=new ResizeObserver((()=>{c((()=>{$?$=!1:W()}),200)()}));return x({send:y}),u((()=>{z=new e.Terminal({cursorBlink:!0,fontSize:14,fontFamily:"Monaco, Menlo, Consolas, 'Courier New', monospace",theme:{background:"#333",foreground:"#ececec"}}),F=new o.FitAddon,L(),B(),N(),W(),(()=>{const e=R.value;e&&q.observe(e)})()})),p((()=>{null==q||q.disconnect()})),(e,o)=>(m(),v("div",{ref_key:"terminalRef",ref:R,class:"w-full box"},null,512))}}),[["__scopeId","data-v-3f2e8f75"]]);export{h as T};
